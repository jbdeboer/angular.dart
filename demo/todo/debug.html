<html>
<head>
    <script src="benchmark.js"></script>
    <style>
        #undertest {
            width: 450px;
            height: 400px;
        }
    </style>
</head>
<body>
<iframe id="undertest" src="index.html"></iframe>
<script>
    var scope;
    window.onload = function() {
        console.log('loaded');
  var ctrlElt = undertest.ngQuery(undertest.document, '[todo-controller]')[0];
  scope = undertest.ngScope(ctrlElt);

        window.setTimeout(function() {
            // Do some stuff.

            var suite = new Benchmark.Suite;
            var i = 0;

            //undertest.__resetTrace();

            // add tests
            suite
                    .add('No-op digest before todos', function() {
                        scope.$digest();
                    })
                    .add('Add a todo', function() {
                scope.$apply('todo.newItem.text="Automatic auto ' + i++ + '"; todo.add()');

            })
                    .add('No-op digest after todos', function() {
                        scope.$digest();
                    })

            // add listeners
            .on('cycle', function(event) {
              console.log(String(event.target));
                       // undertest.__showTrace();
            })

// run async
.run({ 'async': true });

           // undertest.__resetTrace();
           // scope.$apply('todo.newItem.text="Automatic auto"; todo.add()');
           // undertest.__showTrace();
        }, 500);

    }

    /**

     At HEAD (5b3d5e2f2040c)

      No-op digest before todos x 4,406 ops/sec ±13.31% (92 runs sampled) debug.html:43
Add a todo x 60.12 ops/sec ±13.65% (35 runs sampled) debug.html:43
No-op digest after todos x 119 ops/sec ±0.48% (75 runs sampled)

     Before the optimizations

     No-op digest before todos x 1,252 ops/sec ±4.98% (78 runs sampled) debug.html:43
Add a todo x 27.83 ops/sec ±20.68% (19 runs sampled) debug.html:43
No-op digest after todos x 45.10 ops/sec ±3.78% (57 runs sampled)

     */
</script>
</body>
</html>


